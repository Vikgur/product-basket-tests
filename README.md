# Оглавление

1. [Демонстрационный проект: Тестирование корзины товаров](#демонстрационный-проект-тестирование-корзины-товаров)  
2. [Чек-лист тестов](#чек-лист-тестов)  
    - [Позитивные тесты](#позитивные-тесты)  
    - [Граничные тесты](#граничные-тесты)  
    - [Негативные тесты](#негативные-тесты)
3. [Инструкция по запуску проекта](#инструкция-по-запуску-проекта)

# Демонстрационный проект: Тестирование корзины товаров

## Описание

Этот проект — реализация системы корзины товаров для маркетплейса.  

Реализованы два класса:

- **Product** — представляет товар на маркетплейсе (название, уникальный идентификатор, цена, вес).
- **Basket** — корзина, в которую можно добавлять товары, удалять их, получать список товаров, вычислять итоговую стоимость и стоимость доставки.

В рамках проекта разработано **полное тестовое покрытие**, которое включает позитивные, граничные и негативные тесты.

Для повышения читаемости и переиспользования кода тесты реализованы с использованием параметризации.

Проект написан на **Python** с использованием **pytest** для тестирования.

В `tests/conftest.py` настроена ключевая фикстура:
- **Фикстура для инициализации пустой корзины** — используется для создания новой пустой корзины перед началом каждого теста, чтобы обеспечить чистое начальное состояние и избежать влияния предыдущих тестов.

## Результаты тестов
Скриншот с успешным запуском тестов находится в директории проекта `screenshots`.

---

## Особенности
- Цена товара не может быть меньше **1 у.е.**
- Максимальный вес товаров в корзине: **100 у.е.**
- Максимальное количество товаров в корзине: **30 штук**
- Стоимость доставки:
  - Если итоговая цена меньше 500 у.е. → доставка стоит **250 у.е.**
  - Если итоговая цена от 500 до 999 у.е. → доставка стоит **100 у.е.**
  - Если итоговая цена от 1000 у.е. и выше → доставка **бесплатная**

---

# Чек-лист тестов

## Позитивные тесты

### Проверка свойств пустой корзины (`test_empty_basket_properties`)
- [x] Общая стоимость (`total_price`) равна 0.
- [x] Общий вес (`total_weight`) равен 0.
- [x] Стоимость доставки (`get_shipping_cost`) равна 0.
- [x] Итоговая стоимость (`get_price`) равна 0.
- [x] Список товаров (`list_products`) пуст.

### Добавление одного товара с разными параметрами (`test_add_single_product`)
- [x] Добавление одного товара с указанной ценой и весом.
- [x] Корректный расчёт стоимости доставки в зависимости от цены.

### Удаление товара из корзины (`test_delete_product`)
- [x] Успешное удаление товара из корзины.
- [x] Проверка отсутствия удалённого товара в списке.

### Добавление товара и проверка итоговых параметров (`test_add_product`)
- [x] Успешное добавление товара в корзину.
- [x] Пересчёт итоговой стоимости корзины.
- [x] Пересчёт итогового веса корзины.
- [x] Проверка наличия товара в списке товаров.
- [x] Корректный расчёт стоимости доставки.

### Добавление нескольких разных товаров (`test_add_multiple_products`)
- [x] Успешное добавление нескольких разных товаров.
- [x] Корректный подсчёт общей стоимости товаров.
- [x] Корректный подсчёт общего веса товаров.
- [x] Корректная стоимость доставки.

### Последовательное использование корзины (добавление, удаление) (`test_sequential_usage`)
- [x] Добавление нескольких товаров.
- [x] Удаление одного типа товара.
- [x] Корректное обновление итоговых показателей (цена, вес, количество товаров).

### Последовательные операции (`test_sequential_operations`)
- [x] Последовательное добавление товаров.
- [x] Удаление товаров.
- [x] Повторное добавление товаров.
- [x] Корректное обновление состояния корзины после последовательных операций.

### Смешанные операции с товарами (`test_mixed_operations`)
- [x] Чередование добавления, удаления и повторного добавления товаров.
- [x] Корректная работа корзины при сложной последовательности действий.

### Проверка, что `list_products` возвращает копию списка (`test_list_products_returns_copy`)
- [x] Возвращается копия списка товаров.
- [x] Изменение копии не влияет на внутреннее состояние корзины.

### Проверка, что каждый вызов `list_products` возвращает новый экземпляр (`test_list_products_multiple_calls_return_new_instance`)
- [x] Каждый вызов возвращает новый экземпляр списка.
- [x] Изменение одного списка не влияет на другой.

### Проверка уникальности идентификаторов товаров (`test_unique_product_ids`)
- [x] Каждый товар имеет уникальный идентификатор.

### Проверка уникальности идентификаторов после операций удаления/добавления (`test_sequential_operations_unique_ids`)
- [x] Создание товара A и его удаление.
- [x] Создание товаров B и C.
- [x] Проверка, что ID товаров B и C уникальны и не совпадают с ID удалённого товара A.

## Граничные тесты

### Невозможность изменить свойства объекта `Product` (`test_product_immutability`)
- [x] Свойства объекта `Product` доступны только для чтения.

### Проверка стоимости доставки на граничных значениях цены (`test_shipping_cost`)
- [x] Корректный расчёт стоимости доставки при переходе через ценовые пороги.

### Проверка добавления 30 товаров (предел количества) (`test_reaching_max_items_limit`)
- [x] Успешное добавление 30 товаров.
- [x] Попытка добавить 31-й товар вызывает исключение.

### Проверка добавления товаров до максимального веса (100 у.е.) (`test_reaching_max_weight_limit`)
- [x] Успешное добавление товаров до достижения веса 100 у.е.
- [x] Попытка превысить лимит веса вызывает исключение.

### Работа с экстремальными значениями цены и веса (`test_extreme_values`)
- [x] Создание товара с экстремально высокой ценой и минимальным весом.
- [x] Проверка корректного подсчёта общей стоимости корзины.
- [x] Проверка корректного подсчёта общего веса корзины.
- [x] Подтверждение бесплатной доставки при экстремальной цене.
- [x] Проверка итоговой стоимости без дополнительных доплат.

## Негативные тесты

### Попытка создать товар с некорректными параметрами (0 цена или вес) (`test_invalid_product_creation`)
- [x] Попытка создать товар с ценой 0 вызывает ошибку.
- [x] Попытка создать товар с весом 0 вызывает ошибку.
- [x] Попытка создать товар с ценой и весом равными 0 вызывает ошибку.

### Добавление 0 товаров в корзину (`test_add_zero_products`)
- [x] Попытка добавить 0 товаров должна быть отклонена или проигнорирована.

### Добавление отрицательного количества товаров (`test_negative_quantity`)
- [x] Попытка добавить отрицательное количество товаров вызывает ошибку или отклоняется.

### Передача некорректных типов данных в методы корзины (`test_invalid_data_in_basket_methods`)
- [x] Попытка передать невалидные типы данных в методы корзины обрабатывается корректно.

### Удаление несуществующего товара (`test_delete_nonexistent_product`)
- [x] Попытка удалить товар, которого нет в корзине, не вызывает ошибок и не меняет состояние корзины.

### Удаление товара с неправильным типом идентификатора (`test_delete_product_invalid_type`)
- [x] Попытка удалить товар с некорректным типом ID (например, строка) игнорируется без ошибок.

### Удаление товара с корректным, но неподходящим `hashable` ключом (`test_delete_product_invalid_hashable_key`)
- [x] Попытка удалить товар с типом ключа `float` или `tuple` не вызывает ошибок, но не изменяет корзину.

### Удаление товара с некорректным (`unhashable`) ключом, выбрасывающее `TypeError` (`test_delete_product_invalid_unhashable_key`)
- [x] Попытка удалить товар с `list` или `dict` в качестве ключа выбрасывает `TypeError`.
- [x] Корзина остаётся неизменной после выброса исключения.

# Инструкция по запуску проекта

## 1. Установка Python

Убедитесь, что у вас установлен Python версии 3.10 или выше:

```bash
python3 --version
```

Если версия Python ниже 3.10, обновите Python перед продолжением.

## 2. Установка Poetry

Проверьте наличие Poetry:

```bash
poetry --version
```

Если Poetry не установлен, установите его командой:

```bash
curl -sSL https://install.python-poetry.org | python3 -
export PATH="$HOME/.local/bin:$PATH"
```

> Если команда `poetry` не распознаётся, убедитесь, что вы добавили Poetry в `PATH`.

## 3. Клонирование репозитория

Клонируйте проект и перейдите в его директорию:

```bash
git clone git@github.com:Vikgur/product-basket-tests.git
cd product-basket-tests
```

## 4. Настройка виртуального окружения

Создайте виртуальное окружение на основе Python 3:

```bash
poetry env use python3
```

Установите зависимости проекта:

```bash
poetry install --with dev
```

> Файл `poetry.lock` добавлен в репозиторий для синхронизации версий зависимостей.

## 5. Запуск тестов

### Полный запуск тестов с подробным выводом параметризированных данных и покрытием `coverage`

```bash
poetry run coverage run -m pytest tests/test_*.py -v
poetry run coverage report -m | grep "tests/test_"
```

- Флаг `-v` включает подробный вывод всех параметризаций.
- `grep` фильтрует отчёт по строкам с тестовыми файлами для удобства просмотра.

### Запуск без подробного (`-v`) вывода

```bash
poetry run coverage run -m pytest tests/test_*.py
poetry run coverage report -m | grep "tests/test_"
```

### Обычный запуск тестов без покрытия `coverage`

```bash
poetry run pytest
```
